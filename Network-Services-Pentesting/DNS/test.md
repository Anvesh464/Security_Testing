# DNS Overview

**DNS (Domain Name System)** allows users to connect to websites using domain names instead of IP addresses. It resolves a domain name to a fixed IP address.

## Key Points

- **Port**: DNS usually uses **port 53**.
- **Working Logic**:
  
  ![DNS working logic](media/468e724adddf76abaf6985307719c328.png)

### How DNS Works

-   When “secybr.com” is typed in the address bar of the browser, a DNS Query is sent to determine the IP address of the website.
-   This request is first asked to our computer’s DNS cache. If it is among the records, the remaining steps are skipped and automatically redirected to “secybr.com”.
-   If it doesn’t have a record in our DNS cache, the query is sent to our local DNS server. This is usually the servers of our internet provider and they are called resolvers.
-   If no DNS records are found in the resolver, the query is directed to another server called “Root Name Server” to find DNS records.
-   Root Name Servers are the servers responsible for the storage of DNS data worldwide and the smooth operation of the system.
-   After the DNS record is found by the root Name Server, it returns to our computer and is cached by our computer.

## Common DNS Vulnerabilities

### 1. DNS Zone Transfer Vulnerability
- DNS servers can share records via the **AXFR protocol** for load balancing or fault tolerance.
- If misconfigured, unauthorized users may access all DNS records, exposing potential attack vectors.
- **Prevention**: Configure DNS servers to allow zone transfers only from trusted IP addresses.

### 2. DNS Cache Poisoning
- This involves incorrect or malicious entries in the DNS cache, redirecting users to fraudulent websites.
- Attackers can replace legitimate IP addresses with their own.
- **Note**: DNS servers typically use UDP, which lacks authentication, making these attacks feasible.

### 3. Windows DNS Server Remote Code Execution
- Critical vulnerability **CVE-2020-1350** allows attackers to send crafted DNS requests to execute remote commands.
- This vulnerability has existed for 17 years, affecting an estimated 140,000 open DNS servers.

## DNS Pentesting Techniques

### Shodan Search Query
- **Query**: `port:53` or `port:"53" "Recursion: enabled"`

### Banner Grabbing
- Use the following command to detect the version:
  ```bash
  dig version.bind CHAOS TXT @DNS
  ```

### Zone Transfer Check
- Use **nmap** and **dig** commands:
  ```bash
  sudo nmap -Pn -sU --script=dns-check-zone -p 53 secybr.com
  dig axfr @<DNS_IP> <DOMAIN>
  ```

### Gathering Information with `dig`
- Various commands to gather specific DNS information:
  ```bash
  dig ANY @<DNS_IP> <DOMAIN>
  dig A @<DNS_IP> <DOMAIN>
  dig AAAA @<DNS_IP> <DOMAIN>
  dig TXT @<DNS_IP> <DOMAIN>
  dig MX @<DNS_IP> <DOMAIN>
  dig NS @<DNS_IP> <DOMAIN>
  dig -x 10.10.x.x @<DNS_IP>
  ```

### Using `nslookup`
- Example queries:
  ```bash
  nslookup > SERVER <IP_DNS>
  ```

### Useful Metasploit Modules
- Use the following module for enumeration:
  ```bash
  msf > use auxiliary/gather/enum_dns
  ```

### Useful Nmap Scripts
- To run several DNS-related scripts:
  ```bash
  sudo nmap -Pn -sU -n --script "(default and *dns*) or fcrdns or dns-srv-enum or dns-random-txid or dns-random-srcport" <IP_DNS>
  ```

### Gathering More Information with `dnsrecon`
- Example commands:
  ```bash
  dnsrecon -r 192.168.x.x/24 -n <IP_DNS>
  dnsrecon -d secybr.com -a -n <IP_DNS>
  ```

### DNS Brute Forcing
- Tools for brute forcing subdomains:
  ```bash
  dnsrecon -D subdomains-1000.txt -d secybr.com -n <IP_DNS>
  dnscan -d secybr.com -r -w subdomains-1000.txt
  ```

## Active Directory Servers
- Use the following **dig** commands to find Active Directory services:
  ```bash
  dig -t _gc._tcp.lab.secybr.com
  ```

## Finding Subdomains with Nmap Scripts
- Example command:
  ```bash
  nmap -sSU -p53 --script dns-nsec-enum --script-args dns-nsec-enum.domains=domain.com ns3.isc-sns.info
  ```

## IPv6
- Brute force attack using “AAAA” requests:
  ```bash
  dnsdict6 zonetransfer.me
  ```

## DNS Recursion DDoS
- Check if DNS recursion is enabled:
  ```bash
  sudo nmap -Pn -sU -p 53 --script=dns-recursion <IP_DNS>
  ```

### Checking Recursion Availability
- Query to check recursion:
  ```bash
  dig secybr.com A @<IP_DNS>
  ```

## Additional Tools
- **Fierce** for domain enumeration:
  ```bash
  fierce --domain twitter.com --subdomains accounts admin ads
  ```

This structured format should enhance readability and understanding of the DNS content. Let me know if you need further modifications or additional information!
