# 5800,5801,5900,5901 - Pentesting VNC

## Basic Information

**Virtual Network Computing (VNC)** is a graphical desktop-sharing system that allows users to remotely control another computer's desktop over a network connection. It is widely used for remote administration, support, and screen sharing.

VNC operates on a client-server architecture, where the VNC server runs on the remote computer and the VNC client software is used to access and interact with the remote desktop.

VNC usually uses ports **5800 or 5801 or 5900 or 5901.**

```
PORT    STATE SERVICE
5900/tcp open  vnc
```
## Connect
```
# Connect Using VNC Viewer
VNC Viewer is a popular client software used to connect to VNC servers:
vncviewer <target-ip>:<port>

## Connect Using Remmina
Remmina is another remote desktop client that supports VNC connections:
remmina
```
## Banner Grabbing
Banner grabbing can be performed using tools like Netcat to identify VNC services and their versions:
```
nc -nv <target-ip> 5900
```
## Enumeration

```bash
nmap -sV --script vnc-info,realvnc-auth-bypass,vnc-title -p <PORT> <IP>
msf> use auxiliary/scanner/vnc/vnc_none_auth
```
## Default Authentication
VNC servers often use default or weak credentials. Enumeration involves trying common username-password combinations:
```
vncviewer -passwd passwords.txt <target-ip>
```
### [**Brute force**](../generic-hacking/brute-force.md#vnc)

## Weak Authentication
Exploiting weak or default credentials is a common attack vector. Tools like Hydra can be used for brute-forcing VNC passwords:
```
hydra -V -f -L users.txt -P passwords.txt vnc://<target-ip>
```
## Man-in-the-Middle (MITM) Attacks
MITM attacks can intercept VNC traffic and manipulate data exchanged between the client and server:
```
arpspoof -i <interface> -t <target-ip> <gateway-ip>
```
## VNC Injection
Attackers can inject keystrokes and mouse movements into VNC sessions to gain control over the remote desktop:
```
vncinject <target-ip>
```
## Post-Exploitation
Remote Code Execution (RCE)
Successful exploitation may lead to remote code execution, allowing attackers to execute arbitrary commands on the target system:
```
vncexec <target-ip> ls -la
```
## Data Exfiltration
Attackers can exfiltrate sensitive data from the remote desktop:
```
scp user@<target-ip>:/path/to/file /local/path
```
## Privilege Escalation
Exploiting vulnerabilities in the VNC server software or the underlying operating system can lead to privilege escalation:
```
sudo -s
```

### Connect to vnc using Kali

```bash
vncviewer [-passwd passwd.txt] <IP>::5901
```

### Decrypting VNC password

Default **password is stored** in: \~/.vnc/passwd

If you have the VNC password and it looks encrypted (a few bytes, like if it could be an encrypted password), it is probably ciphered with 3des. You can get the clear text password using [https://github.com/jeroennijhof/vncpwd](https://github.com/jeroennijhof/vncpwd)

```bash
make
vncpwd <vnc password file>
```

You can do this because the password used inside 3des to encrypt the plain-text VNC passwords was reversed years ago.\
For **Windows** you can also use this tool: [https://www.raymond.cc/blog/download/did/232/](https://www.raymond.cc/blog/download/did/232/)\
I save the tool here also for ease of access:

{% file src="../.gitbook/assets/vncpwd.zip" %}

## Shodan

* `port:5900 RFB`

NC - Port 5900 

## We always find openVNCs in an engagement. 

VNC Authentication Scanner 

Module will test a VNC server on a range of machines and report successful logins. Currently it supports RFB protocol version 3.3, 3.7, 3.8 and 4.001 using the VNC challenge response authentication method. 
```
use auxiliary/scanner/vnc/vnc_login 
```
## VNC Password 

~/.vnc/passwd is the default location where the VNC password is stored. The password is stored at this location when the vncserver starts for a first time. To update or change your VNC password you should use vncpasswd command. 
```
echo MYVNCPASSWORD | vncpasswd -f > ~/.secret/passvnc 
Warning: password truncated to the length of 8. 
cat ~/.secret/passvnc 
kRS�ۭx8 
Now, if we have found the password file of the VNC on some CTF challenge or vulnerable machine, we can either decrypt it (to know the password) using VNC Password Decrypter or use the password file while using vncviewer 
vncviewer hostname-of-vnc-server -passwd ~/.secret/passvnc 
 
-passwd passwd-file File from which to get the password (as generated by the vncpasswd(1) program). This option affects only the standard VNC authentication.
````
