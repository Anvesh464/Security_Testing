# 111/TCP/UDP - Pentesting Portmapper

## Basic Information

rpcbind is used by RPC (Remote Procedure Call) services. An RPC service is a server-based service that fulfills remote procedure calls. rpcbind is used to determine which services can respond to incoming requests to perform the specified service.

**Default port:** 111/TCP/UDP, 32771 in Oracle Solaris

```
PORT      STATE   SERVICE
111/tcp   open    rpcbind
```
## Connect
Confirming that the rpcbind service runs on a target machine is usually the first step.
```
nc -z -v -u <target-ip> 111
```
## Enumeration
When connected to a machine rpcbind, you can use the rpcinfo tool to learn the details of rpcbind service.
```
rpcinfo -p <target-ip>
rpcinfo irked.htb
nmap -sSUC -p111 192.168.10.1
```
## Attack Vectors
There are various rpcbind modules in Metasploit. For example, you can use the following Metasploit commands for the rpcbind_cgi_mainenv vulnerability
```
msfconsole
use auxiliary/gather/rpcbind_cgi_mainenv
set RHOST <target-ip>
run
```
## RPCBind + NFS

If you find the service NFS then probably you will be able to list and download(and maybe upload) files:
![](<../.gitbook/assets/image (872).png>)
Read[ 2049 - Pentesting NFS service](nfs-service-pentesting.md) to learn more about how to test this protocol.

## NIS
Exploring **NIS** vulnerabilities involves a two-step process, starting with the identification of the service `ypbind`. The cornerstone of this exploration is uncovering the **NIS domain name**, without which progress is halted.
![](<../.gitbook/assets/image (859).png>)

The exploration journey begins with the installation of necessary packages (`apt-get install nis`). The subsequent step requires using `ypwhich` to confirm the NIS server's presence by pinging it with the domain name and server IP, ensuring these elements are anonymized for security.

The final and crucial step involves the `ypcat` command to extract sensitive data, particularly encrypted user passwords. These hashes, once cracked using tools like **John the Ripper**, reveal insights into system access and privileges.

```bash
# Install NIS tools
apt-get install nis
# Ping the NIS server to confirm its presence
ypwhich -d <domain-name> <server-ip>
# Extract user credentials
ypcat –d <domain-name> –h <server-ip> passwd.byname
```

### NIF files

| **Master file**  | **Map(s)**                  | **Notes**                         |
| ---------------- | --------------------------- | --------------------------------- |
| /etc/hosts       | hosts.byname, hosts.byaddr  | Contains hostnames and IP details |
| /etc/passwd      | passwd.byname, passwd.byuid | NIS user password file            |
| /etc/group       | group.byname, group.bygid   | NIS group file                    |
| /usr/lib/aliases | mail.aliases                | Details mail aliases              |

## Post-Exploitation
RPC Dictionary Attack
If you successfully exploited vulnerabilities and obtained a username and password, you can create an RPC bridge as follows using rpcclient
```
rpcclient -U "username%password" <target-ip>
```
## Service Abuse
If a certain RPC service created a vulnerability on the target machine, you can abuse this service to influence behaviors on the target system or hinder its proper operation. For example, you can stop the following RPC service:
```
rpcclient -U "username%password" <target-ip> -c 'stop service_name'
```
### Shodan

* `port:111 portmap`
  
## HackTricks Automatic Commands

```
Protocol_Name: Portmapper    #Protocol Abbreviation if there is one.
Port_Number:  43     #Comma separated if there is more than one.
Protocol_Description: PM or RPCBind        #Protocol Abbreviation Spelled out

Entry_1:
  Name: Notes
  Description: Notes for PortMapper
  Note: |
    Portmapper is a service that is utilized for mapping network service ports to RPC (Remote Procedure Call) program numbers. It acts as a critical component in Unix-based systems, facilitating the exchange of information between these systems. The port associated with Portmapper is frequently scanned by attackers as it can reveal valuable information. This information includes the type of Unix Operating System (OS) running and details about the services that are available on the system. Additionally, Portmapper is commonly used in conjunction with NFS (Network File System), NIS (Network Information Service), and other RPC-based services to manage network services effectively.

    https://book.hacktricks.xyz/pentesting/pentesting-rpcbind

Entry_2:
  Name: rpc info
  Description: May give netstat-type info
  Command: whois -h {IP} -p 43 {Domain_Name} && echo {Domain_Name} | nc -vn {IP} 43

Entry_3:
  Name: nmap
  Description: May give netstat-type info
  Command: nmap -sSUC -p 111 {IP}
```
