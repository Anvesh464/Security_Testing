# LDAP Documentation

## Overview

**LDAP** (Lightweight Directory Access Protocol) is a protocol that enables applications to query user information rapidly. Companies store usernames, passwords, email addresses, printer connections, and other static data within directories. LDAP is an open, vendor-neutral application protocol for accessing and maintaining that data. It can also handle authentication, allowing users to sign on once and access multiple files on the server.

### Key Features
- **Descriptive:** Multiple points, such as name and location, define an asset.
- **Static:** The information changes infrequently.
- **Valuable:** Data stored is critical to core business functions.

### Common Ports
- **389:** LDAP
- **636:** LDAPS (SSL)
- **3268:** LDAP Global Catalog
- **3269:** LDAPS Global Catalog

## The LDAP Process Explained

The average employee connects with LDAP dozens or even hundreds of times per day, often without realizing it. The LDAP query process involves:

1. **Session Connection:** The user connects to the server via an LDAP port.
2. **Request:** The user submits a query (e.g., email lookup).
3. **Response:** The LDAP protocol queries the directory and delivers the information.
4. **Completion:** The user disconnects from the LDAP port.

### Authentication Methods
- **Simple:** Requires a username and password.
- **SASL (Simple Authentication and Security Layer):** Uses a secondary service (e.g., Kerberos) for authentication.

Most LDAP communication is sent without encryption, which can lead to security issues. Companies often use Transport Layer Security (TLS) for secure LDAP messaging.

## LDAP Operations

Users can perform various operations with LDAP:

- **Add:** Enter a new file into the database.
- **Delete:** Remove a file from the database.
- **Search:** Query to find something within the database.
- **Compare:** Examine two files for similarities or differences.
- **Modify:** Change an existing entry.

## Important LDAP Terms

- **Data Models:** Types of information in your directory.
- **Distinguished Name (DN):** Unique identifier for each entry.
- **Modifications:** Requests to alter data associated with an entry.
- **Relative Distinguished Name (RDN):** Ties DNs together while specifying relative location.
- **Schema:** Describes the format and attributes of each item on the server.
- **URLs:** Address and port of a server along with additional data.
- **Uniform Resource Identifier (URI):** Defines a resource.

## General Information

### Architecture
- **DC:** Domain Component (domain name)
- **OU:** Organizational Unit (folders)
- **CN:** Common Name (name given to objects, e.g., Username, Group name)

### Interesting Attributes for User Class
```bash
ldapsearch "(objectClass=user)"
```
- `sAMAccountName`
- `userPrincipalName`
- `memberOf` (groups)
- `badPwdCount` (failed logins)
- `lastLogoff` (timestamp)
- `lastLogon` (timestamp)
- `pwdLastSet` (timestamp)
- `logonCount`

### Interesting Attributes for Group Class
```bash
ldapsearch "(objectClass=group)"
```
- `cn`
- `member` (one per user/group)
- `memberOf` (if nested in another group)

### Interesting Attributes for Computer Class
```bash
ldapsearch "(objectClass=computer)"
```
- `name` (NetBIOS name)
- `DNSHostName` (FQDN)
- `operatingSystem`
- `operatingSystemVersion` (patch level)
- `lastLogonTimestamp`
- `servicePrincipalName` (running services)

## LDAP Pentesting

### Shodan Search Query
```plaintext
port:389,636,3268
```

### Banner Grabbing
```bash
nmap -sV -p389 10.10.x.x
```

### Basic Enumeration
You can attempt to enumerate an LDAP with or without credentials using Python:
```bash
pip3 install ldap3
```
First, try to connect without credentials:
```python
import ldap3
server = ldap3.Server('10.10.x.x', get_info=ldap3.ALL, port=636, use_ssl=True)
connection = ldap3.Connection(server)
connection.bind()  # True
server.info
```

If the response is `True`, you can obtain interesting data from the LDAP server:
```python
server.info  # DSA info (from DSE): Supported LDAP versions: 3 Naming contexts: dc=DOMAIN,dc=DOMAIN
```

### Extracting Information
To dump the whole LDAP:
```python
connection.search(search_base='DC=DOMAIN,DC=DOMAIN', search_filter='(&(objectClass=person))', search_scope='SUBTREE', attributes='userPassword')
```

## Credentials Handling

### Plaintext Credentials
If LDAP is used without SSL, credentials can be sniffed in plaintext. A MITM attack can also be performed.

### Valid Credentials
If you have valid credentials, you can dump domain information:
```bash
pip3 install ldapdomaindump
ldapdomaindump -u secybr.com\\0xhav0c -p 'Password' 10.10.x.x
```

### Brute Forcing
```bash
nmap --script ldap-brute -p 389 10.10.x.x
```

### Null Credentials Check
```bash
ldapsearch -x -h 10.10.x.x -D '' -w '' -b "DC=<1_SUBDOMAIN>,DC=<TDL>"
```

## Conclusion
This document provides a comprehensive overview of LDAP, its operations, and security considerations. For further details and examples, please refer to the original sources.

---

**Example taken from:** [n00py.io](https://www.n00py.io/2020/02/exploiting-ldap-server-null-bind/)
```

### Notes:
- This format is structured for better readability on GitHub, utilizing headers, lists, and code blocks.
- You may need to adjust some sections based on your specific preferences or additional content that you might want to include.
