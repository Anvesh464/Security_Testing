# Mobile Application Security with AndroGoat
<img src="androgoat_files/image001.png">

Have you ever wondered about the vulnerabilities hidden beneath the surface of your favorite mobile apps? I certainly did, which is why I dove headfirst into the deep end of mobile application training and found a mobile application that I can train with. [AndroGOAT](https://github.com/satishpatnayak/AndroGoat) is an app filled with secrets, each one is a teachable moment in mobile application security. With this article, I’m opening up my diary of discoveries, sharing all the technical moments from my AndroGOAT journey. So feel free to follow along as we explore security flaws of this vulnerable mobile app together!

## Installation

For this walkthrough, I am using a physical Android phone and a VM (Genymotion). You don't have to use my exact method of setup; you can place platform tools and the APK file in the same location or provide the full path of their location in order to install the AndroGOAT application to run the Android virtual machine.

<img src="androgoat_files/image002.png">

You can either drag and drop the APK file of AndroGoat onto the Android VM or install it with Android Debug Bridge (adb).

### Installation with ADB:

1. Open Command Prompt and navigate to the location of the AndroGoat APK file.

<img src="androgoat_files/image003.png">

2. Run the following command to check the status of any Android device running on your system:
   ```bash
   adb devices
   ```

<img src="androgoat_files/image004.png">

3. Now, install the AndroGoat application by running:
   ```bash
   adb install AndroGoat.apk
   ```

You will get success status printed on command line:

<img src="androgoat_files/image005.png">

Icon of AndroGoat app will also appear on your VM as shown below:

<img src="androgoat_files/image006.png"> 

5. Tap (Click) on the AndroGoat app icon to launch the application.

<img src="androgoat_files/image007.png">  

---

## Network Interception Setup

### 1. HTTP

Set up a proxy on your mobile phone like this:

<img src="androgoat_files/image008.png">  

The IP address `192.168.18.231` is the IP address of my computer, which is connected to the internet.

<img src="androgoat_files/image009.png">  

Start BurpSuite and enter the proxy details in the Proxy Listener section:

<img src="androgoat_files/image010.png">  

Then open the AndroGoat application and click on HTTP, and the traffic will be intercepted in BurpSuite:

<img src="androgoat_files/image011.png">  

### 2. Intercepting HTTPS

For task 2, we need to export Burpsuite SSL certificate to mobile phone, so that HTTPs based traffic can be intercepted. Certificate exporting option is shown below.

<img src="androgoat_files/image012.png"> 

Enter the file name with the `.cer` extension:

<img src="androgoat_files/image013.png">  

Transfer `burp.cer` to the mobile phone’s files folder, and go to the certificate option in your mobile phone settings.

<img src="androgoat_files/image014.png">  

Phone types and menus vary but if you are having issues finding the certificate menu then try to search for “certificate”:

<img src="androgoat_files/image015.png"> 

After installing the certificate on the mobile phone, navigate to the folder where the certificate is stored.

<img src="androgoat_files/image016.png">  

Click on the certificate and install it. Select the option “VPN and Apps” using any preferred name and press OK:

<img src="androgoat_files/image017.png">  

Now, go to the application and click on HTTPS. After 5–10 seconds, [**https://owasp.org**](https://owasp.org/) will be intercepted by BurpSuite:

<img src="androgoat_files/image018.png">  

### 3. Certificate Pinning

To bypass certificate pinning, install Frida Server and send the server file to the rooted Android phone's location `/data/local/tmp`.

<img src="androgoat_files/image019.png">  

Install Frida tools on your Windows/Linux system:

<img src="androgoat_files/image020.png">  

Now go to android phone location and run the command:

```bash
chmod +x frida-server-16.0.9-android-arm64
```

After running this, type the following command to start the Frida server:

<img src="androgoat_files/image021.png"> 

Run the following command on your host PC to check if Frida is installed correctly:

<img src="androgoat_files/image022.png">  

Now install the [Objection framework](https://github.com/sensepost/objection) and run it on your host system.

<img src="androgoat_files/image023.png">  

Run the following command to bypass SSL/Certificate pinning on the AndroGoat Application:

```bash
objection --g owasp.sat.agoat explore --s "android sslpinning disable"
```
<img src="androgoat_files/image024.png">  

Click on the "Certificate Pinning" activity in AndroGoat:

<img src="androgoat_files/image025.png"> 

---

## Unprotected Android Components

According to the code, if the correct pin is inserted, the `AccessControl1ViewActivity` will be called:

![image](https://github.com/user-attachments/assets/1420f74c-dd5f-44aa-9d29-4f6d96b178c9)

Instead of providing the correct pin, you can directly jump to the `AccessControl1ViewActivity` by using the following command:

```bash
adb shell am start -n owasp.sat.agoat/.AccessControl1ViewActivity
```
![image](https://github.com/user-attachments/assets/a117a480-7b30-4aa0-88ce-ed4359241ccc)

After running the command successfully, the following activity will be shown:

![image](https://github.com/user-attachments/assets/d9590c23-2163-43f7-adf9-384e274df458)

---

## Insecure Data Storage

### 1. Shared Preferences (Part 1)

In this task, input the username and password, then click on "Save."

![image](https://github.com/user-attachments/assets/56a2d62a-e6f9-4db3-8380-28190d35f336)

Go into android shell by typing the following commands

```bash
adb shell > su > cd /data/data/owasp.sat.agoat/shared_prefs
```

Then type ls command to list all files and you should see interesting files including users.xml. :)

Show the content of the xml files with cat or nano:

```bash
cat users.xml
```
![image](https://github.com/user-attachments/assets/965f7ffa-b12b-47e1-a015-61533819813b)

### 2. Shared Preferences (Part 2)

Click on “Shared Preferences — Part 2” to open a scorecard.

![image](https://github.com/user-attachments/assets/15324e6d-c48e-4a08-913d-3ec5a68c4963)

Navigate to `/data/data/owasp.sat.agoat/shared_prefs`

Type the ls command and there will be new file present there named score.xml`score.xml`.

![image](https://github.com/user-attachments/assets/b936e350-cbaa-4d5d-8a23-8453a63882cf)

Now edit the score.xml file either by exporting it or by editing it in the location and values will be reflected on the activity page as shown below:

![image](https://github.com/user-attachments/assets/3cb62903-85be-47fa-97b0-bcb2184d5098)
![image](https://github.com/user-attachments/assets/2de45692-3592-4f69-a9bf-7430b4ce7060)

---
**3. SQLite**

Next in the Insecure Data Storage section, go to SQLite and enter any username and password and click on Save option.

![](media/8ec6207732890e869f6ad6281bd06d9e.png)

Now go to **cd /data/data/owasp.sat.agoat/databases** and type **ls –l** to list databases.  
After that type **sqlite3 \<database_name\>** , list tables using the command, **.tables**, and enumerate the table contents by typing **select \* from users**;

![](media/f09c2bfd48e5e94d8c1c80f7aecb1739.png)

**4. Temp File**

The temp file is created when a user enters username and password.

![](media/5c1069e9bcbd30f906a9d4fd05bfcd17.png)

After the temp file is created in the application container, go to the application container by **cd /data/data/owasp.sat.agoat/** and then type **ls –l.**

Display the contents of the file **users\*tmp** and it will list the sensitive contents (i.e. username/password) in plaintext.

![](media/db8044db806456a7242bc30a27702d5e.png)

**5. External Storage — SDCard**

![](media/9cfaca5a2a22cd7201c40a6f9ac45c7a.png)

For this one, ensure that you have granted permissions to the mobile application as shown here:

![](media/4ca3b8457e65933a88b9701ef291b67f.png)

Now to take a look at the code, open the .apk AndroGoat file in jadx tool and go to **InsecureStorageSDCardActivit**y.

![](media/59d5b478db0e60294eb954a1fbd46075.png)

As shown in the red box, the data is going to be stored in SDCARD (external storage) with name “**users”** prefix **“tmp”** as postfix and **input userinfo** will be stored there.

Now access the device with **adb shell \> su \> cd /sdcard/** and type **ls –l** and cat users\*tmp.

![](media/7b3540c950b9cc2b80aa87e46d696252.png)

**Input Validations**

1.  **Cross-Site Scripting (XSS)**

XSS (Cross Site Scripting) attacks are a type of injection, in which malicious scripts are injected into otherwise benign and trusted websites. In this case due to lack of input validation any simple/ complex script written in the input text field will be reflected back to user. Like for example write a javascript line i.e \<script\>alert(‘hello’)\</script\>

![](media/f6c82ceb422f753bcdab51f073e5be76.png)

**2. SQL Injection (SQLi)**

SQL Injection (SQLi) is a common attack vector that uses malicious SQL code for backend database manipulation to access information that was not intended to be displayed.

Following is the screenshot of the code running behind this SQLIActivity, as depicted in the code, there is no input validation on username and if any person enters special chars, then it will get reflected into database or data will be retrieved from database.

![](media/b65981769de42d87b5c5855b135ab8f4.png)

As shown below input **‘ or 1=1 —** it will fetch data from database because of lack of input validation whilst fetching data from database. It will enumerate all values from database (aGoat) and list all users.

![](media/503818314272fc974b2b0814f2b12598.png)

**3. WebView**

In web view activity, due to lack of input validations and lack of **setAllowFileAccess** parameter and javascript is enabled, so it will display user sensitive info from application container, if exact path is entered.

![](media/52e63c4efdc33be0fe956ecf09aa66b7.png)

Enter exact path of any sensitive resource with prefix **file:///,** as shown in following application screenshot.

![](media/f6f9b322b724d2a96218255e8311a384.png)

**Side Channel Data Leakage**

1.  **Keyboard Cache**

Keystrokes are logged in a particular location of application context as shown:

![](media/3653337ed765c4a5794d7b193bc41c48.png)

Open the keyboard cache and type in some simple phrases in the username and password fields.

![](media/e45bac6162e5aba8f9403a4b406f4cb0.png)

Go the shell of android phone and navigate to user history by using the below location:

adb shell  
su  
cd /data/data/com.google.android.inputmethod.latin/files/personal/userhistory

Now cat out the contents of **UserHistory.en_GB.dict** as shown in subsequent pictures. (However, if your keyboard input language is different then it will show with different name here.)

![](media/28137ab9b06bd2b7004bd3ce62b67d86.png)

![](media/4965ecb4d7df4216552d977806f32d8a.png)

In the contents of userhistory.en_GB.dict you will see the keystrokes strokes input by the user, which was me in this case:

![](media/2bfdfa319c5f2efe586732ed7de56d52.png)

**2. Insecure Logging**

First inspect the code by going into **InsecureLoggingActivity** in Jadx and study the code as shown below.

![](media/2865d865d49272919984780bd9ff029d.png)

As shown in the picture figure, **Log.e** is logging username and password into log of the application.

Now just type **adb logcat** and enter any credentials in GUI of application as shown below and keep the adb logcat running.

In the logcat activity logs, the details of usernames and passwords will be displayed in text.

![](media/dc5a76efe2a3b82bb44669433b97a1e4.png)

![](media/59fc18023e19d698d979e2efc7a8898a.png)

**3. Clipboard — Copy and Paste**

Insert some test numbers for a credit card like this:

![](media/83a2ccfc38a6b09f04f37d01dea2e393.png)

For the security flaw in this area, the sensitive data is wrongfully being displayed in plaintext (ClipboardActivity).

![](media/6f19c58fb911098abeb7bf3524834e14.png)

**Hardcode Issue**

Inspect the relevant activity **HardCodeActivity** class and notice the hardcoded promocode as shown:

![](media/1166074e77ef376323f161d12ff9bfe9.png)

Now insert the discovered value **NEW2019** into the application:

![](media/9055217a05c81f88c1ab4efdc4e68a0f.png)

After clicking on verify, the price will go to zero:

![](media/e3254bebc6fcf2c58e64b102cb520307.png)

**RootDetection**

![](media/4e3c16599c255c6c39b71bd2e958fe62.png)

Inspect the **IsRooted** activity as shown below:

![](media/839284310976ba3248458e751713df86.png)

There are number of ways to bypass these checks, like using RootCloak, Frida scripts and Magisk. However, we will use the Objection Framework tool already used by us in the **Certificate Pinning activity**. Now, run the Frida server as already shown and type the following command to bypass the root detection:

objection –g owasp.sat.agoat explore –s "android root disable"

The command above is only different from the objection certificate pinning command at the string “**root”.**

![](media/8827fb8963c45a27943b1296a68a2132.png)

After successfully running the command, go to the root activity and it will now get successfully bypassed:

![](media/3514d5826f24b01c9067a53d2c7f4517.png)

**Emulator Detection**

While reviewing the emulator detection code and you will find that the **isEmulator()** function code contains the logic to check for detection of an emulator.

![](media/b9dd07270e10c53b7d5b1f3e0e5c2b29.png)

Now, open objection framework and the application:

objection -g owasp.sat.agoat explore

![](media/93d5aabb1a1a4cccc960d1d113d303fa.png)

You should be able to list all the class methods with the following command:

android hooking list class_methods owasp.sat.agoat.EmulatorDetectionActivity

![](media/eca4e57519665c6a9c803a2fa147d41f.png)

In the above mentioned you will see to that all class methods of **EmulatorDetectionActivity** are listed in the figure. Now, hook the method isEmulator using following command:

android hooking set return_value owasp.sat.agoat.EmulatorDetectionActivity.isEmulator false

![](media/65a59ce1f703b17faa881294178bb75d.png)

Now click on check emulator activity and it will display that the device is not an emulator:

![](media/60f25e47eefab948d8223e007c3c9be0.png)

**Binary Patching**

![](media/77ce9e0360d09fcf67ddbdf347bcb998.png)

Inspect the activity of Binary Patching and understand the logic. Here we want to patch the function **isAdmin()** so that it to returns true.

![](media/e1e8e440811dc5d8b66d54f19776767d.png)

To decompile this, run apktool with following command:

java -jar apktool.jar d -r "C:\\Users\\Administrator\\Downloads\\AndroGoat.apk" -f

Successfully running the command on Windows should look like this:

![](media/416125d3686aa538145bbbb854059a54.png)

*File location may vary, depending on the stored location of AndroGoat.apk*

Now, view the smali files and navigate to the **BinaryPatchingActivity.smali**

![](media/2c7a26328987adab638488293dfb1f72.png)

Now take a look at the line 16 and notice that the **if-ne** (if not equal) is looking for the **isAdminText condition.**

![](media/ec2f957e1850f35d9dde3990eca953e0.png)

Change **if-ne** to **if-eq** so that **isAdmin** results into always true as shown below:

![](media/09b9a4df14c40c512582227b349bf0f9.png)

Now save the file and build the application folder (AndroGoat) with apktool using this command:

java -jar apktool.jar b -r AndroGoat/ -o test.apk

Download and run [**uber-apk-signer**](https://github.com/patrickfav/uber-apk-signer) with following command in order to properly sign and zipalign the output file test.apk:

java -jar uber-apk-signer-1.3.0.jar --apks test.apk

*Note: The above version 1.3.0 may vary depending on when you do this*

Now install the output application, **test-aligned-debugSigned.apk** in the android phone.

Now open the application and go to binary patching and you will see “You are admin now”, signifying that application is successfully patched.

![](media/0f8c5d5f428c29ef0d33c60efb10a29d.png)

I hope you were able to follow along and learn something new from this walkthrough!

